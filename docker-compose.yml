# Vault-integrated version
# Stack: pia
# Deploy with:
#   docker compose -f pia-vault.yaml --env-file .env up -d

networks:
  vault-network:
    external: true
    name: vault-network

services:
  pia-wg-generator:
    container_name: pia-wg-generator
    image: fbeilke/pia-wg-generator:latest
    restart: unless-stopped
    networks:
      - vault-network
    env_file:
      - /shared-configs/env/pia.env
    # No need for command override - the entrypoint handles Vault
    environment:
      VAULT_ADDR: "${VAULT_ADDR}"
      VAULT_TOKEN: "${VAULT_TOKEN}"
      CONFIG_DIR: "/configs"
      DEBUG: "0"
      PIA_USER: "p2259420"
      REGIONS: "de_berlin,br,de-frankfurt,nl_amsterdam,no,sweden,uk"
      UPDATE_INTERVAL: "0 */12 * * *"
    volumes:
      - /mnt/storage/configs/docker-stacks/vault-shared/scripts:/vault-shared/scripts:ro
      - /mnt/storage/downloads/pia-wireguard:/configs
      - /mnt/storage/configs/pia-wireguard/logs:/logs
